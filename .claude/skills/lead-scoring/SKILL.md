---
name: lead-scoring
description: CRMのリードに対してスコアリング（A/B/Cランク判定）を実行し、推奨アクションを生成する
allowed-tools: AskUserQuestion, Bash, Read, Write
---

# リードスコアリング

CRMに登録済みのリード企業に対して、企業属性・接触結果・レポートデータを元にスコアリングを実施し、
A/B/Cランク判定と推奨アクションを生成します。

## ステップ1: 対象リードの特定

引数 `$ARGUMENTS` から対象を判定します。

- 会社名が指定された場合: その会社を対象にする
- `--all` が指定された場合: CRM内のスコア未記入の全リードを対象にする
- 何も指定されていない場合: AskUserQuestion で会社名を確認する

## ステップ2: CRMデータの読み取り

リポジトリのルートディレクトリで以下を実行し、CRMから対象のデータを取得します：

```bash
npx tsx scripts/read-crm-lead.ts --company-name "{会社名}"
```

または一括の場合:
```bash
npx tsx scripts/read-crm-lead.ts --unscored
```

出力されるJSONフィールド:
- `rowIndex`: CRM上の行番号
- `companyName`, `siteUrl`, `address`, `phone`: 基本情報
- `reportUrl`: レポートURL
- `outreachMessage`: フォーム営業文
- `status`: 現在のステータス
- `score`, `rank`: 現在のスコア/ランク（あれば）
- `pipeline`: パイプラインステージ
- `dealAmount`, `winProbability`, `expectedCloseDate`: ディール情報
- `contactName`, `contactEmail`, `contactDepartment`: 担当者情報
- `lastContactDate`: 最終接触日

## ステップ3: レポートデータの読み込み

リポジトリの `data/out/` フォルダから `*_outreach-data.json` を探し、該当企業のデータがあれば Read ツールで読み込みます。

```bash
ls data/out/*outreach-data.json
```

レポートデータがある場合、以下をスコアリングに活用:
- `initiatives[]`: AI施策一覧（施策数・効果額）
- `industry`: 業種
- `businessSummary`: 事業概要

## ステップ4: 接触情報の収集

AskUserQuestion で以下を確認します:

**質問1: 接触経路**
- フォーム / テレアポ / 訪問 / メール返信 / まだ接触していない

**質問2: 反応温度**（接触済みの場合）
- 前のめり（積極的に質問・メモを取る）
- 普通（話は聞くが質問なし）
- 薄い（明らかに興味なし）
- 未接触

**質問3: 接触メモ**（任意）
- 通話内容、反応の詳細、困りごと等のフリーテキスト

## ステップ5: スコア算出

以下のルールに従ってスコアを算出します。

### A. ルールベース（基本スコア）

| 項目 | 条件 | 点数 |
|---|---|---|
| 反応温度: 前のめり | | +40 |
| 反応温度: 普通 | | +20 |
| 反応温度: 薄い | | +5 |
| 反応温度: 未接触 | | +0 |
| 電話番号取得済み | CRMのphone列が非空 | +10 |

### B. 接触経路ボーナス

| 経路 | 基本点 | 追加条件 |
|---|---|---|
| メール返信 | +30 | 「詳しく聞きたい」「会えますか」→さらに+30 |
| | | 具体的課題を記載→さらに+20 |
| | | 「資料が欲しい」→さらに+10 |
| | | 「タイミングが来たら」（保留）→さらに+0 |
| フォーム | +20 | 具体的記載あり→さらに+20 |
| 訪問 | +15 | |
| テレアポ | +10 | |
| 未接触 | +0 | |

### C. AI判定（レポートデータがある場合のみ）

レポートデータ（initiatives, industry, businessSummary）と接触メモを総合的に判断し、
以下の3軸で加点します（各0〜20点、合計最大60点）:

- **デジタル成熟度**: HP情報やレポート施策からAI活用への準備度を推定
- **ROI適合度**: 施策のROIが高く、自社サービスとのフィットが良いか
- **緊急度シグナル**: 接触メモから緊急性のシグナルがあるか

AI判定を行う際は、上記3つの軸ごとに点数と理由を明記してください。

### D. ランク判定

| ランク | スコア範囲 | 即時アクション |
|---|---|---|
| **A** | 70点以上 | 24時間以内に個別返信・アポ打診 |
| **B** | 40〜69点 | ナーチャリング5ステップ配信 |
| **C** | 39点以下 | 3〜6ヶ月後リスト |

## ステップ6: 結果の表示

スコアリング結果をわかりやすく表示します:

```
━━━━━━━━━━━━━━━━━━━━━━━━
スコアリング結果: {会社名}
━━━━━━━━━━━━━━━━━━━━━━━━
スコア: {合計点}点 → ランク: {A/B/C}

【内訳】
- 反応温度（{温度}）: +{点}
- 接触経路（{経路}）: +{点}
- 電話番号: +{点}
- AI判定: +{点}（デジタル成熟度{n} / ROI適合度{n} / 緊急度{n}）

【推奨アクション】
{ランクに応じた具体的なアクション1〜2文}
━━━━━━━━━━━━━━━━━━━━━━━━
```

推奨アクションの生成ルール:
- Aランク: 「24時間以内に電話でアポ打診。話すポイント: {接触メモから抽出した具体的なポイント}」
- Bランク: 「ナーチャリングシーケンスへ登録。{業種}向けの事例を中心にフォロー」
- Cランク: 「3ヶ月後リストへ移動。{次回接触時のフック}」

## ステップ7: CRM更新

AskUserQuestion で「スコアリング結果をCRMに書き込みますか？」と確認します。

「はい」の場合、リポジトリのルートで以下を実行:

```bash
npx tsx scripts/update-crm-score.ts \
  --company-name "{会社名}" \
  --score {スコア} \
  --rank "{ランク}" \
  --contact-type "{接触経路}" \
  --memo "{反応メモ（シェルエスケープ注意）}" \
  --action "{推奨アクション}"
```

メモやアクションが長い場合は一時ファイル経由で渡してください。

ランクに応じてH列（ステータス）とO列（パイプライン）も自動更新されます:
- A → ステータス「Aランク対応中」/ パイプライン「商談」
- B → ステータス「ナーチャリング中」/ パイプライン「アプローチ中」
- C → ステータス「3ヶ月後フォロー」/ パイプライン「リード」

ステータスを変更したくない場合は `--no-status-update` を付与してください。

スコアリング実行時にアクティビティタブにも自動で記録されます。
